<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">

<div th:insert="~{fragments/header :: header}"></div>

<body>

	<!-- NAVIGATION depuis le fragment nav -->
	<div th:insert="~{fragments/nav :: nav}"></div>

	<!-- Message de d√©connexion -->
	<div th:if="${message}" class="alert alert-success">
		<p th:text="${message}"></p>
	</div>
	<style>
h2 {
	margin: 3.5rem;
	text-align: left;
}

.card-module {
	background: linear-gradient(135deg, #18181e, #2c2c39);
	border-radius: 2rem;
	padding: 1rem;
	margin: 2rem auto;
	display: flex;
	width: 90%;
}

.element-module {
	width: 30%;
}

.card-image {
	width: 100%;
	border-radius: 1rem;
	padding: 0.5rem 0;
}

.card-title {
	margin-bottom: 0.5rem;
}

.sous-module-container {
	display: flex;
	align-items: center;
	width: 70%;
	overflow: hidden;
	padding-left: 1rem;
}

.sous-module-slider {
	display: flex;
	gap: 1rem;
	overflow-x: auto;
	scroll-behavior: smooth;
	max-width: 100%;
}

.sous-module {
	min-width: 250px;
	background-color: #34344a;
	padding: 0.5rem;
	border-radius: 1rem;
	text-align: center;
}

.sous-module img {
	width: 100%;
	border-radius: 0.5rem;
}

.arrow-button {
	background: none;
	border: none;
	color: white;
	font-size: 1.5rem;
	cursor: pointer;
	padding: 0 1rem;
}
</style>
</head>

<body>
	<!-- Message de bienvenue -->
	<div>
		<h2 th:if="${admin != null}">
			Bienvenue, <span style="color: #f37500;" th:text="${admin.username}">Admin</span>
			üëã
		</h2>
		<h2 th:if="${admin == null}">Bienvenue invit√© üëã</h2>
	</div>

	<!-- Alerte session -->
	<p th:if="${isSessionMode}" class="text-warning text-center fw-bold">
		‚ö†Ô∏è Vous √™tes dans une session temporaire. Vos donn√©es ne seront pas
		sauvegard√©es.</p>

	<main>
		<div class="container">
			<!-- Affichage des modules -->
			<div th:each="module, iterStat : ${modules}"
				class="card-module row col-12 mb-4">
				<!-- Titre & image du module -->
				<div class="element-module">
					<h3 class="card-title" th:text="${module.nom}"></h3>
					<img th:src="@{${module.image}}" alt="Image du module"
						class="card-image" />
				</div>

				<!-- Sous-modules avec slider -->
				<div class="card-body sous-module-container">
					<button class="arrow-button arrow-left" type="button"
						th:attr="data-slider-id='slider-' + ${iterStat.index}">&#8592;</button>

					<div class="sous-module-slider"
						th:id="'slider-' + ${iterStat.index}">
						<div th:each="sm : ${module.sousModules}" class="sous-module">
							<h6 class="card-title" th:text="${sm.titre}"></h6>
							<a th:href="@{'/modules/accueil-modules/' + ${sm.id}}">
								<img th:src="${sm.imageUrl}" alt="Image du sous-module" />
							</a>

							<!-- <a th:href="@{/modules/accueil-modules}"> <img th:src="@{${sm.imageUrl}}"
								alt="Image du sous-module" class="sm-card-image" />
							</a> -->
						</div>
					</div>

					<button class="arrow-button arrow-right" type="button"
						th:attr="data-slider-id='slider-' + ${iterStat.index}">&#8594;</button>
				</div>
			</div>
		</div>
	</main>

	<!-- Script slider -->
	<script>
function updateArrowVisibility(slider, leftArrow, rightArrow) {
    // Cache la fl√®che gauche si on est au d√©but
    if (slider.scrollLeft <= 0) {
        leftArrow.style.visibility = 'hidden';
    } else {
        leftArrow.style.visibility = 'visible';
    }

    // Cache la fl√®che droite si on est √† la fin
    if (slider.scrollLeft + slider.offsetWidth >= slider.scrollWidth - 1) {
        rightArrow.style.visibility = 'hidden';
    } else {
        rightArrow.style.visibility = 'visible';
    }
}

document.querySelectorAll('.card-module').forEach(module => {
    const slider = module.querySelector('.sous-module-slider');
    const leftArrow = module.querySelector('.arrow-left');
    const rightArrow = module.querySelector('.arrow-right');

    if (!slider || !leftArrow || !rightArrow) return;

    // Initialiser la visibilit√©
    updateArrowVisibility(slider, leftArrow, rightArrow);

    // Ajouter l'√©coute sur scroll manuel aussi
    slider.addEventListener('scroll', () => {
        updateArrowVisibility(slider, leftArrow, rightArrow);
    });

    // Ajouter les √©v√©nements aux fl√®ches
    [leftArrow, rightArrow].forEach(button => {
        button.addEventListener('click', () => {
            const direction = button.classList.contains('arrow-left') ? -1 : 1;
            const scrollAmount = 300;

            slider.scrollBy({
                left: direction * scrollAmount,
                behavior: 'smooth'
            });

            // Laisser le scroll se faire puis mettre √† jour les fl√®ches
            setTimeout(() => {
                updateArrowVisibility(slider, leftArrow, rightArrow);
            }, 300);
        });
    });
});
</script>


</body>
</html>
