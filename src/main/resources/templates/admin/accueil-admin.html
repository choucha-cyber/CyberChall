<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">

<!-- HEADER -->
<div th:insert="~{fragments/header :: header}"></div>
<!--  PLACER LOGO (gauche) = TITRE CyberChall + Deconnexion seulement (+ = reste de la nav) -->
<!-- NAVIGATION  <div th:insert="~{fragments/nav :: nav}"></div> -->
<nav>
	<div class="logo">
		<img src="/images/logo.png" alt="Logo Cadettes de la Cyber">
	</div>
	<h1 id="toggle-nav"><a th:href="@{/}">CyberChall</a></h1>
<div id="nav-container" style="display: none;">
  <div th:insert="~{fragments/nav :: nav}"></div>
</div>
	<ul>
		<li><a
			th:href="${estConnecte} ? @{/deconnexion} : (role == 'admin' ? @{/admin/connexion-admin} : @{/})"
			th:text="${estConnecte} ? 'D√©connexion' : 'Connexion'"> </a></li>
		<li>+</li>
	</ul>

</nav>
<style>
h2 {
	text-align: left;
	margin: 2rem;
}

ul {
	display: flex;
	list-style: none;
}

a {
	text-decoration: none;
	margin: 1rem;
	color: white;
}

.card-module, .sous-module-container, .sous-module {
	background: linear-gradient(135deg, #18181e, #2c2c39);
	color: white;
}

.card-module {
	width: 90%;
	border-radius: 2rem;
	display: flex;
	margin: 2rem;
	padding: 1rem;
}

h5.card-title {
	width: fit-content;
}

.card-image {
	width: 100%;
	border-radius: 1rem;
}

.element-module {
	width: 30%;
}

.sous-module-container {
	margin-left: 1rem;
	width: inherit;
	border: none;
	padding: 1rem;
	display: flex;
	border-radius: 1rem;
}

.sous-module-slider {
	display: flex;
	overflow-x: auto;
	scroll-behavior: smooth;
	gap: 1rem;
	max-width: 100%;
}

.sous-module {
	width: 30%; /* ajuste selon la taille souhait√©e */
	flex-shrink: 0;
	padding: 0.6rem;
	margin: 0.8rem;
	border-radius: 1rem;
}

.arrow-button {
	height: fit-content;
}

.sm-card-image {
	background-color: white;
	width: 90%;
	border-radius: 1rem;
}
</style>

<body>
	<!-- ‚úÖ Message de bienvenue clair  en haut a gauche sous la nav -->
	<div>
		<h2 th:if="${admin != null}">
			Bienvenue, <span style="color: #f37500;" th:text="${admin.username}">Admin</span>
			üëã
		</h2>
		<h2 th:if="${admin == null}">Bienvenue invit√© üëã</h2>
	</div>

	<main class="admin">

		<!-- üî∏ Alerte session temporaire -->
		<p th:if="${isSessionMode}" class="text-warning text-center fw-bold">
			‚ö†Ô∏è Vous √™tes dans une session temporaire. Vos donn√©es ne seront pas
			sauvegard√©es.</p>

		<!-- ‚úÖ Affichage des modules -->
		<div class="container ">
			<div th:each="module, iterStat : ${modules}"
				class="row col-12 mb-4 card card-module">
				<!-- <div th:each="module, iterStat : ${modules}"
					class="col-12 mb-4">   <div class="card card-module"> -->
				<!--  titre module -->
				<div class="element-module">
					<h3 class="card-title" th:text="${module.nom}"></h3>
					<!--  image module -->
					<img th:src="@{${module.image}}" alt="Image du module"
						class="card-image" />
				</div>
				<div class="card-body sous-module-container">
					<!-- Slider sous-modules avec fl√®ches -->
					<!--  <div class="sous-module-container"> -->
					<!-- Fl√®che gauche -->
					<button class="arrow-button arrow-left" type="button"
						data-slider-id="slider-[[${iterStat.index}]]">&#8592;</button>

					<!-- Conteneur scrollable -->
					<div class="sous-module-slider d-flex overflow-auto"
						style="scroll-behavior: smooth; gap: 1rem; max-width: 100%;"
						id="slider-[[${iterStat.index}]]">

						<!-- Sous-modules dans le slider -->
						<div th:each="sm : ${module.sousModules}" class="sous-module">
							<h6 class="card-title" th:text="${sm.titre}"></h6>
							<a th:href="@{${sm.link}}"> <img th:src="@{${sm.imageUrl}}"
								alt="Image du sous-module" class="sm-card-image" />
								<!--  exemple de lien/chenmin  de redirection : /modules/cyberattaque/types-cyberattaques -->
							</a>
						</div>
					</div>

					<!-- Fl√®che droite -->
					<button class="arrow-button arrow-right" type="button"
						data-slider-id="slider-[[${iterStat.index}]]">&#8594;</button>

				</div>
			</div>
		</div>
	</main>

	<script>
function updateArrowVisibility(slider, leftArrow, rightArrow) {
    // Cache la fl√®che gauche si on est au d√©but
    if (slider.scrollLeft <= 0) {
        leftArrow.style.visibility = 'hidden';
    } else {
        leftArrow.style.visibility = 'visible';
    }

    // Cache la fl√®che droite si on est √† la fin
    if (slider.scrollLeft + slider.offsetWidth >= slider.scrollWidth - 1) {
        rightArrow.style.visibility = 'hidden';
    } else {
        rightArrow.style.visibility = 'visible';
    }
}

document.querySelectorAll('.card-module').forEach(module => {
    const slider = module.querySelector('.sous-module-slider');
    const leftArrow = module.querySelector('.arrow-left');
    const rightArrow = module.querySelector('.arrow-right');

    if (!slider || !leftArrow || !rightArrow) return;

    // Initialiser la visibilit√©
    updateArrowVisibility(slider, leftArrow, rightArrow);

    // Ajouter l'√©coute sur scroll manuel aussi
    slider.addEventListener('scroll', () => {
        updateArrowVisibility(slider, leftArrow, rightArrow);
    });

    // Ajouter les √©v√©nements aux fl√®ches
    [leftArrow, rightArrow].forEach(button => {
        button.addEventListener('click', () => {
            const direction = button.classList.contains('arrow-left') ? -1 : 1;
            const scrollAmount = 300;

            slider.scrollBy({
                left: direction * scrollAmount,
                behavior: 'smooth'
            });

            // Laisser le scroll se faire puis mettre √† jour les fl√®ches
            setTimeout(() => {
                updateArrowVisibility(slider, leftArrow, rightArrow);
            }, 300);
        });
    });
});

// Nav
const title = document.getElementById('toggle-nav');
  const nav = document.getElementById('nav-container');

  title.addEventListener('mouseenter', () => {
    nav.style.display = 'block';
  });

  title.addEventListener('mouseleave', () => {
    setTimeout(() => nav.style.display = 'none', 300);
  });

  nav.addEventListener('mouseenter', () => {
    nav.style.display = 'block';
  });

  nav.addEventListener('mouseleave', () => {
    nav.style.display = 'none';
  });
</script>

	<!-- FOOTER -->
	<div th:insert="~{fragments/footer :: footer}"></div>
</body>
</html>